---
import { Image } from "@astrojs/image/components";
import { getCollection, getEntryBySlug } from "astro:content";
import BaseLayout from "../../components/base.astro";

export async function getStaticPaths() {
  const posts = await getCollection("posts");
  return posts.map(post => ({
    params: { slug: post.slug }
  }));
}

const post = await getEntryBySlug("posts", Astro.params.slug!);
---

<BaseLayout title={post?.data.title} description={post?.data.summary}>
  <section class='flow'>
    <h1>{post?.data.title}</h1>
    <p>
      {post?.data.date.toLocaleDateString("en-gb", { dateStyle: "long" })}
    </p>
    <hr />
    <p>{post?.data.summary}</p>
    <Image
      format='webp'
      width={1000}
      height={600}
      src={post?.data.image!}
      alt={`${post?.data.title} hero image`}
    />
    <article class='flow'>
      {post?.render().then(({ Content }) => <Content />)}
    </article>
  </section>
</BaseLayout>
